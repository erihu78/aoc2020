-- Input is stored in simple table 
-- CREATE TABLE AOC5 (ID NUMBER,VAL VARCHAR2(100));
-- ID is just a sequence to use as as primary key, VAL is the row from input-text.

--Part 1
WITH SEATS AS (
SELECT ID,VAL,R1,R2,R3,R4,R5,R6,R7,R1+R2+R3+R4+R5+R6+R7 AS ROWNR,S1,S2,S3,S1+S2+S3 AS SEATNR,((R1+R2+R3+R4+R5+R6+R7)*8)+(S1+S2+S3) AS SEAT_ID FROM (
SELECT ID,VAL,
COUNT(1) OVER(),
NVL(DECODE(SUBSTR(VAL,1,1),'F',0,'B',1),0)*CEIL((128)/2) AS R1,
NVL(DECODE(SUBSTR(VAL,2,1),'F',0,'B',1),0)*CEIL((128)/4) AS R2,
NVL(DECODE(SUBSTR(VAL,3,1),'F',0,'B',1),0)*CEIL((128)/8) AS R3,
NVL(DECODE(SUBSTR(VAL,4,1),'F',0,'B',1),0)*CEIL((128)/16) AS R4,
NVL(DECODE(SUBSTR(VAL,5,1),'F',0,'B',1),0)*CEIL((128)/32) AS R5,
NVL(DECODE(SUBSTR(VAL,6,1),'F',0,'B',1),0)*CEIL((128)/64) AS R6,
NVL(DECODE(SUBSTR(VAL,7,1),'F',0,'B',1),0)*CEIL((128)/128) AS R7,
NVL(DECODE(SUBSTR(VAL,8,1),'L',0,'R',1),0)*4 AS S1,
NVL(DECODE(SUBSTR(VAL,9,1),'L',0,'R',1),0)*2 AS S2,
NVL(DECODE(SUBSTR(VAL,10,1),'L',0,'R',1),0)*1 AS S3
FROM AOC5 )
--WHERE VAL IN ('FBFBBFFRLR','FFFBBBFRRR','BBFFBBFRLL','BFFFBBFRRR')
ORDER BY R1+R2+R3+R4+R5+R6+R7,S1+S2+S3)
SELECT MAX(SEAT_ID) FROM SEATS
;

--Part 2
WITH SEATS AS (
SELECT ID,VAL,ROW_NR,SEAT_NR,SEAT_ID,LEAD(SEAT_ID,1) OVER(ORDER BY SEAT_ID) AS NEXT_SEAT_ID,LAG(SEAT_ID,1) OVER(ORDER BY SEAT_ID) AS PREV_SEAT_ID FROM (
SELECT ID,VAL,R1,R2,R3,R4,R5,R6,R7,R1+R2+R3+R4+R5+R6+R7 AS ROW_NR,S1,S2,S3,S1+S2+S3 AS SEAT_NR,((R1+R2+R3+R4+R5+R6+R7)*8)+(S1+S2+S3) AS SEAT_ID FROM (
SELECT ID,VAL,
COUNT(1) OVER(),
NVL(DECODE(SUBSTR(VAL,1,1),'F',0,'B',1),0)*CEIL((128)/2) AS R1,
NVL(DECODE(SUBSTR(VAL,2,1),'F',0,'B',1),0)*CEIL((128)/4) AS R2,
NVL(DECODE(SUBSTR(VAL,3,1),'F',0,'B',1),0)*CEIL((128)/8) AS R3,
NVL(DECODE(SUBSTR(VAL,4,1),'F',0,'B',1),0)*CEIL((128)/16) AS R4,
NVL(DECODE(SUBSTR(VAL,5,1),'F',0,'B',1),0)*CEIL((128)/32) AS R5,
NVL(DECODE(SUBSTR(VAL,6,1),'F',0,'B',1),0)*CEIL((128)/64) AS R6,
NVL(DECODE(SUBSTR(VAL,7,1),'F',0,'B',1),0)*CEIL((128)/128) AS R7,
NVL(DECODE(SUBSTR(VAL,8,1),'L',0,'R',1),0)*4 AS S1,
NVL(DECODE(SUBSTR(VAL,9,1),'L',0,'R',1),0)*2 AS S2,
NVL(DECODE(SUBSTR(VAL,10,1),'L',0,'R',1),0)*1 AS S3
FROM AOC5 ))
--WHERE VAL IN ('FBFBBFFRLR','FFFBBBFRRR','BBFFBBFRLL','BFFFBBFRRR')
ORDER BY R1+R2+R3+R4+R5+R6+R7,S1+S2+S3)
SELECT SEAT_ID+1 FROM SEATS WHERE SEAT_ID+1!=NEXT_SEAT_ID AND NEXT_SEAT_ID IS NOT NULL ORDER BY SEAT_ID
;